{% capture installments_config %}
[
  {"count": 1, "rate": 0, "interest": false},
  {"count": 2, "rate": 0, "interest": false},
  {"count": 3, "rate": 0, "interest": false},
  {"count": 4, "rate": 0, "interest": false},
  {"count": 5, "rate": 0, "interest": false},
  {"count": 6, "rate": 0, "interest": false}
]
{% endcapture %}
{% assign installment_options = installments_config | strip | parse_json %}
{% assign highlight_installment = 6 %}
{% assign selected_variant = product.selected_or_first_available_variant %}
{% assign variant_price = selected_variant.price %}
{% assign highlight_option = installment_options | where: 'count', highlight_installment | first %}
{% assign summary_option = highlight_option %}
{% if summary_option == blank %}
  {% assign summary_option = installment_options | last %}
{% endif %}
{% assign summary_installment_count = summary_option.count | default: highlight_installment %}
{% assign summary_total_price = variant_price %}
{% assign summary_double_total = summary_total_price | times: 2 %}
{% assign summary_adjusted_total = summary_double_total | plus: summary_installment_count %}
{% assign summary_double_count = summary_installment_count | times: 2 %}
{% assign highlight_installment_value = summary_adjusted_total | divided_by: summary_double_count %}
{% assign reward_points = variant_price | divided_by: 100 | floor %}
{% capture summary_text %}
  Parcelas: até {{ summary_installment_count }}x sem juros de {{ highlight_installment_value | money | replace: 'hidewlm', 'aria-hidden="true"' }}
{% endcapture %}

<div
  class="installments"
  data-installments
  data-section="{{ section.id }}"
  data-initial-price="{{ variant_price }}"
  data-installments-config='{{ installment_options | json }}'
  data-highlight-installment="{{ highlight_installment }}"
  data-summary-template="Parcelas: até %count%x sem juros de %value%"
  data-money-format='{{ shop.money_format | replace: "hidewlm", "aria-hidden=\"true\"" | replace: "'", "&#39;" }}'
  data-interest-label="{{ 'products.product.installments.with_interest' | t }}"
  data-no-interest-label="{{ 'products.product.installments.without_interest' | t }}"
  data-table-heading-installments="{{ 'products.product.installments.table_heading_installments' | t }}"
  data-table-heading-value="{{ 'products.product.installments.table_heading_value' | t }}"
>
  <script type="application/json" data-installments-config>
    {{ installment_options | json }}
  </script>
  <div class="installments__header">
    <p class="installments__summary" aria-live="polite">
      <span class="installments__summary-icon" aria-hidden="true">
        <svg width="16" height="16" viewBox="0 0 24 24" role="presentation" focusable="false">
          <path
            fill="currentColor"
            d="M21 4H3a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2m0 14H3V10h18zm0-12v2H3V6z"
          />
        </svg>
      </span>
      <span class="visually-hidden">{{ 'products.product.installments.icon_label' | t }}</span>
      <span class="installments__summary-text" data-installments-summary>
        {{ summary_text | strip | strip_newlines }}
      </span>
    </p>
  </div>

  <p
    class="installments__points"
    data-installments-points
    data-installments-points-template="Pontos: ganhe %points% pontos"
  >
    Pontos: ganhe {{ reward_points }} pontos
  </p>
</div>
